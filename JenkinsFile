node {

	def application = "dockerjenkinsapp"

	def dockerhubaccountid = "donalkens"

	stage('Clone repository') {

		checkout scm

	}



	stage('Build image') {

		app = docker.build("${dockerhubaccountid}/${application}:${BUILD_NUMBER}")

	}



	stage('Push image') {

		withDockerRegistry([ credentialsId: "dockerHub", url: "" ]) {

		app.push()

		app.push("latest")

	}

	}



	stage('Deploy') {

		sh ("docker run -d -p 80:3000 ${dockerhubaccountid}/${application}:${BUILD_NUMBER}")

	}

	

	stage('Remove old images') {

		// remove docker old images

		sh("docker rmi ${dockerhubaccountid}/${application}:latest -f")

   }

}
